{
    "case_id": "case-1571",
    "repo_name": "dbcli/mycli",
    "file_path": "mycli/config.py",
    "code_snippet": "    mysql_config_editor.cc.\n\n    The login key is 20-bytes of random non-printable ASCII.\n    It is written to the actual login path file. It is used\n    to generate the real key used in the AES cipher.\n\n    :param f: an I/O object opened in binary mode\n    :return: the decrypted login path file\n    :rtype: io.BytesIO or None\n    \"\"\"\n\n    # Number of bytes used to store the length of ciphertext.\n    MAX_CIPHER_STORE_LEN = 4\n\n    LOGIN_KEY_LEN = 20\n\n    # Move past the unused buffer.\n    buf = f.read(4)\n\n    if not buf or len(buf) != 4:\n        logger.error(\"Login path file is blank or incomplete.\")\n        return None\n\n    # Read the login key.\n    key = f.read(LOGIN_KEY_LEN)\n\n    # Generate the real key.\n    rkey = [0] * 16\n    for i in range(LOGIN_KEY_LEN):\n        try:\n            rkey[i % 16] ^= ord(key[i : i + 1])\n        except TypeError:\n            # ord() was unable to get the value of the byte.\n            logger.error(\"Unable to generate login path AES key.\")\n            return None\n    rkey = struct.pack(\"16B\", *rkey)\n\n    # Create a bytes buffer to hold the plaintext.\n    plaintext = BytesIO()\n    aes = pyaes.AESModeOfOperationECB(rkey)\n\n    while True:\n        # Read the length of the ciphertext.\n        len_buf = f.read(MAX_CIPHER_STORE_LEN)\n        if len(len_buf) < MAX_CIPHER_STORE_LEN:\n            break\n        (cipher_len,) = struct.unpack(\"<i\", len_buf)\n\n        # Read cipher_len bytes from the file and decrypt.\n        cipher = f.read(cipher_len)\n        plain = _remove_pad(b\"\".join([aes.decrypt(cipher[i : i + 16]) for i in range(0, cipher_len, 16)]))\n        if plain is False:\n            continue\n        plaintext.write(plain)\n\n    if plaintext.tell() == 0:\n        logger.error(\"No data successfully decrypted from login path file.\")\n        return None\n\n    plaintext.seek(0)\n    return plaintext\n\n\ndef str_to_bool(s):\n    \"\"\"Convert a string value to its corresponding boolean value.\"\"\"\n    if isinstance(s, bool):\n        return s\n    elif not isinstance(s, basestring):\n        raise TypeError(\"argument must be a string\")\n\n",
    "line_range": [
        225,
        294
    ],
    "command_specific_fields": {
        "method_name": "read_and_decrypt_mylogin_cnf"
    },
    "language": "python",
    "commit": "af5a17d980450e184cfc25e56e0e91a1389d378d",
    "prompt": ""
}