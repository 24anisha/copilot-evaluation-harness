{
    "case_id": "case-660",
    "repo_name": "darknessomi/musicbox",
    "file_path": "NEMbox/menu.py",
    "code_snippet": "        self.stop()\n\n\n\n    def dispatch_enter(self, idx):\n\n        # The end of stack\n\n        netease = self.api\n\n        datatype = self.datatype\n\n        title = self.title\n\n        datalist = self.datalist\n\n        offset = self.offset\n\n        index = self.index\n\n        self.stack.append([datatype, title, datalist, offset, index])\n\n\n\n        if idx >= len(self.datalist):\n\n            return False\n\n\n\n        if datatype == \"main\":\n\n            self.choice_channel(idx)\n\n\n\n        # \u8be5\u827a\u672f\u5bb6\u7684\u70ed\u95e8\u6b4c\u66f2\n\n        elif datatype == \"artists\":\n\n            artist_name = datalist[idx][\"artists_name\"]\n\n            artist_id = datalist[idx][\"artist_id\"]\n\n\n\n            self.datatype = \"artist_info\"\n\n            self.title += \" > \" + artist_name\n\n            self.datalist = [\n\n                {\"item\": \"{}\u7684\u70ed\u95e8\u6b4c\u66f2\".format(artist_name), \"id\": artist_id},\n\n                {\"item\": \"{}\u7684\u6240\u6709\u4e13\u8f91\".format(artist_name), \"id\": artist_id},\n\n            ]\n\n\n\n        elif datatype == \"artist_info\":\n\n            self.title += \" > \" + datalist[idx][\"item\"]\n\n            artist_id = datalist[0][\"id\"]\n\n            if idx == 0:\n\n                self.datatype = \"songs\"\n\n                songs = netease.artists(artist_id)\n\n                self.datalist = netease.dig_info(songs, \"songs\")\n\n\n\n            elif idx == 1:\n\n                albums = netease.get_artist_album(artist_id)\n\n                self.datatype = \"albums\"\n\n                self.datalist = netease.dig_info(albums, \"albums\")\n\n\n\n        elif datatype == \"djRadios\":\n\n            radio_id = datalist[idx][\"id\"]\n\n            programs = netease.alldjprograms(radio_id)\n\n            self.title += \" > \" + datalist[idx][\"name\"]\n\n            self.datatype = \"djprograms\"\n\n            self.datalist = netease.dig_info(programs, \"djprograms\")\n\n\n\n        # \u8be5\u4e13\u8f91\u5305\u542b\u7684\u6b4c\u66f2\n\n        elif datatype == \"albums\":\n\n            album_id = datalist[idx][\"album_id\"]\n\n            songs = netease.album(album_id)\n\n            self.datatype = \"songs\"\n\n            self.datalist = netease.dig_info(songs, \"songs\")\n\n            self.title += \" > \" + datalist[idx][\"albums_name\"]\n\n\n\n        # \u7cbe\u9009\u6b4c\u5355\u9009\u9879\n\n        elif datatype == \"recommend_lists\":\n\n            data = self.datalist[idx]\n\n            self.datatype = data[\"datatype\"]\n\n            self.datalist = netease.dig_info(data[\"callback\"](), self.datatype)\n\n            self.title += \" > \" + data[\"title\"]\n\n\n\n        # \u5168\u7ad9\u7f6e\u9876\u6b4c\u5355\u5305\u542b\u7684\u6b4c\u66f2\n\n        elif datatype in [\"top_playlists\", \"playlists\"]:\n\n            playlist_id = datalist[idx][\"playlist_id\"]\n\n            songs = netease.playlist_songlist(playlist_id)\n\n            self.datatype = \"songs\"\n\n            self.datalist = netease.dig_info(songs, \"songs\")\n\n            self.title += \" > \" + datalist[idx][\"playlist_name\"]\n\n\n\n        # \u5206\u7c7b\u7cbe\u9009\n\n        elif datatype == \"playlist_classes\":\n\n            # \u5206\u7c7b\u540d\u79f0\n\n            data = self.datalist[idx]\n\n            self.datatype = \"playlist_class_detail\"\n\n            self.datalist = netease.dig_info(data, self.datatype)\n\n            self.title += \" > \" + data\n\n\n\n        # \u67d0\u4e00\u5206\u7c7b\u7684\u8be6\u60c5\n\n        elif datatype == \"playlist_class_detail\":\n\n            # \u5b50\u7c7b\u522b\n\n            data = self.datalist[idx]\n\n            self.datatype = \"top_playlists\"\n\n            self.datalist = netease.dig_info(netease.top_playlists(data), self.datatype)\n\n            self.title += \" > \" + data\n\n\n\n        # \u6b4c\u66f2\u8bc4\u8bba\n\n        elif datatype in [\"songs\", \"fmsongs\"]:\n\n            song_id = datalist[idx][\"song_id\"]\n\n            comments = self.api.song_comments(song_id, limit=100)\n\n            try:\n\n                hotcomments = comments[\"hotComments\"]\n\n                comcomments = comments[\"comments\"]\n\n            except KeyError:\n\n                hotcomments = comcomments = []\n\n            self.datalist = []\n\n            for one_comment in hotcomments:\n\n                self.datalist.append(\n\n                    {\n\n                        \"comment_content\": \"(\u70ed\u8bc4 %s\u2764\ufe0f \ufe0f) %s: %s\"\n\n                        % (\n\n                            one_comment[\"likedCount\"],\n\n                            one_comment[\"user\"][\"nickname\"],\n\n                            one_comment[\"content\"],\n\n                        )\n\n                    }\n\n                )\n\n            for one_comment in comcomments:\n\n                # self.datalist.append(one_comment[\"content\"])\n\n                self.datalist.append(\n\n                    {\n\n                        \"comment_content\": \"(%s\u2764\ufe0f \ufe0f) %s: %s\"\n\n                        % (\n\n                            one_comment[\"likedCount\"],\n\n                            one_comment[\"user\"][\"nickname\"],\n\n                            one_comment[\"content\"],\n\n                        )\n\n                    }\n\n                )\n\n            self.datatype = \"comments\"\n\n            self.title = \"\u7f51\u6613\u4e91\u97f3\u4e50 > \u8bc4\u8bba: %s\" % datalist[idx][\"song_name\"]\n\n            self.offset = 0\n\n            self.index = 0\n\n\n\n        # \u6b4c\u66f2\u699c\u5355\n\n        elif datatype == \"toplists\":\n\n            songs = netease.top_songlist(idx)\n\n            self.title += \" > \" + self.datalist[idx]\n\n            self.datalist = netease.dig_info(songs, \"songs\")\n\n            self.datatype = \"songs\"\n\n\n\n        # \u641c\u7d22\u83dc\u5355\n\n        elif datatype == \"search\":\n\n            self.index = 0\n\n            self.offset = 0\n\n            SearchCategory = namedtuple(\"SearchCategory\", [\"type\", \"title\"])\n\n            idx_map = {\n\n                0: SearchCategory(\"playlists\", \"\u7cbe\u9009\u6b4c\u5355\u641c\u7d22\u5217\u8868\"),\n\n                1: SearchCategory(\"songs\", \"\u6b4c\u66f2\u641c\u7d22\u5217\u8868\"),\n\n                2: SearchCategory(\"artists\", \"\u827a\u672f\u5bb6\u641c\u7d22\u5217\u8868\"),\n\n                3: SearchCategory(\"albums\", \"\u4e13\u8f91\u641c\u7d22\u5217\u8868\"),\n\n                4: SearchCategory(\"djRadios\", \"\u4e3b\u64ad\u7535\u53f0\u641c\u7d22\u5217\u8868\"),\n\n            }\n\n            self.datatype, self.title = idx_map[idx]\n\n            self.datalist = self.search(self.datatype)\n\n        else:\n\n            self.enter_flag = False\n",
    "line_range": [
        978,
        1127
    ],
    "command_specific_fields": {
        "method_name": "dispatch_enter"
    },
    "language": "python",
    "commit": "592e13d1b948201447d008f4f3e249d347f47f21",
    "prompt": ""
}