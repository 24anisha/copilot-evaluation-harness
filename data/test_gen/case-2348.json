{
    "case_id": "case-2348",
    "repo_name": "justauth/JustAuth",
    "file_path": "src/main/java/me/zhyd/oauth/request/AuthWeChatMpRequest.java",
    "line_range": [
        42,
        78
    ],
    "command_specific_fields": {
        "method_name": "getUserInfo"
    },
    "language": "java",
    "commit": "694bbf1b010d93404e3bfb4824d90e9ddfaebebb",
    "code_snippet": "    @Override\n    public AuthUser getUserInfo(AuthToken authToken) {\n        String openId = authToken.getOpenId();\n\n        String scope = authToken.getScope();\n        if (!StringUtils.isEmpty(scope) && !scope.contains(\"snsapi_userinfo\")) {\n            return AuthUser.builder()\n                .rawUserInfo(JSONObject.parseObject(JSONObject.toJSONString(authToken)))\n                .uuid(openId)\n                .snapshotUser(authToken.isSnapshotUser())\n                .token(authToken)\n                .source(source.toString())\n                .build();\n        }\n\n        String response = doGetUserInfo(authToken);\n        JSONObject object = JSONObject.parseObject(response);\n\n        this.checkResponse(object);\n        String location = String.format(\"%s-%s-%s\", object.getString(\"country\"), object.getString(\"province\"), object.getString(\"city\"));\n\n        if (object.containsKey(\"unionid\")) {\n            authToken.setUnionId(object.getString(\"unionid\"));\n        }\n        return AuthUser.builder()\n            .rawUserInfo(object)\n            .username(object.getString(\"nickname\"))\n            .nickname(object.getString(\"nickname\"))\n            .avatar(object.getString(\"headimgurl\"))\n            .location(location)\n            .uuid(openId)\n            .snapshotUser(authToken.isSnapshotUser())\n            .gender(AuthUserGender.getWechatRealGender(object.getString(\"sex\")))\n            .token(authToken)\n            .source(source.toString())\n            .build();\n    }\n"
}