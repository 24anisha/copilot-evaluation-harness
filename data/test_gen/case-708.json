{
    "case_id": "case-708",
    "repo_name": "Zulko/moviepy",
    "file_path": "moviepy/audio/io/ffmpeg_audiowriter.py",
    "code_snippet": "        else:\n            cmd.extend([\"-i\", ffmpeg_escape_filename(input_video), \"-vcodec\", \"copy\"])\n\n        cmd.extend([\"-acodec\", codec] + [\"-ar\", \"%d\" % fps_input])\n        cmd.extend([\"-strict\", \"-2\"])  # needed to support codec 'aac'\n        if bitrate is not None:\n            cmd.extend([\"-ab\", bitrate])\n        if ffmpeg_params is not None:\n            cmd.extend(ffmpeg_params)\n        cmd.extend([ffmpeg_escape_filename(filename)])\n\n        popen_params = cross_platform_popen_params(\n            {\"stdout\": sp.DEVNULL, \"stderr\": logfile, \"stdin\": sp.PIPE}\n        )\n\n        self.proc = sp.Popen(cmd, **popen_params)\n\n    def write_frames(self, frames_array):\n        \"\"\"Send the audio frame (a chunck of ``AudioClip``) to ffmpeg for writting\"\"\"\n        try:\n            self.proc.stdin.write(frames_array.tobytes())\n        except IOError as err:\n            _, ffmpeg_error = self.proc.communicate()\n            if ffmpeg_error is not None:\n                ffmpeg_error = ffmpeg_error.decode()\n            else:\n                # The error was redirected to a logfile with `write_logfile=True`,\n                # so read the error from that file instead\n                self.logfile.seek(0)\n                ffmpeg_error = self.logfile.read()\n\n            error = (\n                f\"{err}\\n\\nMoviePy error: FFMPEG encountered the following error while \"\n                f\"writing file {self.filename}:\\n\\n {ffmpeg_error}\"\n            )\n\n            if \"Unknown encoder\" in ffmpeg_error:\n                error += (\n                    \"\\n\\nThe audio export failed because FFMPEG didn't find the \"\n                    f\"specified codec for audio encoding {self.codec}. \"\n                    \"Please install this codec or change the codec when calling \"\n                    \"write_videofile or write_audiofile.\\nFor instance for mp3:\\n\"\n                    \"   >>> write_videofile('myvid.mp4', audio_codec='libmp3lame')\"\n                )\n\n            elif \"incorrect codec parameters ?\" in ffmpeg_error:\n                error += (\n                    \"\\n\\nThe audio export failed, possibly because the \"\n                    f\"codec specified for the video {self.codec} is not compatible\"\n                    f\" with the given extension {self.ext}. Please specify a \"\n                    \"valid 'codec' argument in write_audiofile or 'audio_codoc'\"\n                    \"argument in write_videofile. This would be \"\n                    \"'libmp3lame' for mp3, 'libvorbis' for ogg...\"\n                )\n",
    "line_range": [
        91,
        144
    ],
    "command_specific_fields": {
        "method_name": "write_frames"
    },
    "language": "python",
    "commit": "0f6f6d4d9b96c69d109975549fe6293931f1a19d",
    "prompt": ""
}