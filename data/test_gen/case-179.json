{
    "case_id": "case-179",
    "repo_name": "trekhleb/javascript-algorithms",
    "file_path": "src/algorithms/image-processing/seam-carving/resizeImageWidth.js",
    "code_snippet": " */\n\nconst findLowEnergySeam = (energyMap, { w, h }) => {\n\n  // The 2D array of the size of w and h, where each pixel contains the\n\n  // seam metadata (pixel energy, pixel coordinate and previous pixel from\n\n  // the lowest energy seam at this point).\n\n  const seamPixelsMap = matrix(w, h, null);\n\n\n\n  // Populate the first row of the map by just copying the energies\n\n  // from the energy map.\n\n  for (let x = 0; x < w; x += 1) {\n\n    const y = 0;\n\n    seamPixelsMap[y][x] = {\n\n      energy: energyMap[y][x],\n\n      coordinate: { x, y },\n\n      previous: null,\n\n    };\n\n  }\n\n\n\n  // Populate the rest of the rows.\n\n  for (let y = 1; y < h; y += 1) {\n\n    for (let x = 0; x < w; x += 1) {\n\n      // Find the top adjacent cell with minimum energy.\n\n      // This cell would be the tail of a seam with lowest energy at this point.\n\n      // It doesn't mean that this seam (path) has lowest energy globally.\n\n      // Instead, it means that we found a path with the lowest energy that may lead\n\n      // us to the current pixel with the coordinates x and y.\n\n      let minPrevEnergy = Infinity;\n\n      let minPrevX = x;\n\n      for (let i = (x - 1); i <= (x + 1); i += 1) {\n\n        if (i >= 0 && i < w && seamPixelsMap[y - 1][i].energy < minPrevEnergy) {\n\n          minPrevEnergy = seamPixelsMap[y - 1][i].energy;\n\n          minPrevX = i;\n\n        }\n\n      }\n\n\n\n      // Update the current cell.\n\n      seamPixelsMap[y][x] = {\n\n        energy: minPrevEnergy + energyMap[y][x],\n\n        coordinate: { x, y },\n\n        previous: { x: minPrevX, y: y - 1 },\n\n      };\n\n    }\n\n  }\n\n\n\n  // Find where the minimum energy seam ends.\n\n  // We need to find the tail of the lowest energy seam to start\n\n  // traversing it from its tail to its head (from the bottom to the top).\n\n  let lastMinCoordinate = null;\n\n  let minSeamEnergy = Infinity;\n\n  for (let x = 0; x < w; x += 1) {\n\n    const y = h - 1;\n\n    if (seamPixelsMap[y][x].energy < minSeamEnergy) {\n\n      minSeamEnergy = seamPixelsMap[y][x].energy;\n\n      lastMinCoordinate = { x, y };\n\n    }\n\n  }\n\n\n\n  // Find the lowest energy energy seam.\n\n  // Once we know where the tail is we may traverse and assemble the lowest\n\n  // energy seam based on the \"previous\" value of the seam pixel metadata.\n\n  const seam = [];\n\n\n\n  const { x: lastMinX, y: lastMinY } = lastMinCoordinate;\n\n\n\n  // Adding new pixel to the seam path one by one until we reach the top.\n\n  let currentSeam = seamPixelsMap[lastMinY][lastMinX];\n\n  while (currentSeam) {\n\n    seam.push(currentSeam.coordinate);\n\n    const prevMinCoordinates = currentSeam.previous;\n\n    if (!prevMinCoordinates) {\n\n      currentSeam = null;\n\n    } else {\n\n      const { x: prevMinX, y: prevMinY } = prevMinCoordinates;\n\n      currentSeam = seamPixelsMap[prevMinY][prevMinX];\n\n    }\n\n  }\n\n\n\n  return seam;\n\n};\n",
    "line_range": [
        115,
        194
    ],
    "command_specific_fields": {
        "method_name": "findLowEnergySeam"
    },
    "language": "javascript",
    "commit": "ca3d16dcce7a493ae12c03ca20ede4fd7801f7a2",
    "prompt": ""
}